<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uki's Dive Tools - Test Runner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2.5em;
            color: #00d1b2;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 209, 178, 0.5);
        }

        .subtitle {
            color: #b0b0b0;
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            background: #00d1b2;
            color: #1e1e1e;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 209, 178, 0.3);
        }

        button:hover {
            background: #00c4a7;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 209, 178, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        button.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        #status {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 100px;
            display: none;
        }

        #status.visible {
            display: block;
        }

        .status-header {
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .status-running {
            color: #ffdd57;
        }

        .status-success {
            color: #00d1b2;
        }

        .status-error {
            color: #ff3860;
        }

        #results {
            display: none;
        }

        #results.visible {
            display: block;
        }

        .summary {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #00d1b2;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 0 30px rgba(0, 209, 178, 0.3);
        }

        .summary h2 {
            color: #00d1b2;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #b0b0b0;
            font-size: 0.9em;
        }

        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.2s ease;
        }

        .test-result:hover {
            transform: translateX(5px);
        }

        .test-result.pass {
            background: rgba(0, 209, 178, 0.1);
            border-color: #00d1b2;
        }

        .test-result.fail {
            background: rgba(255, 56, 96, 0.1);
            border-color: #ff3860;
        }

        .test-result.skip {
            background: rgba(255, 221, 87, 0.1);
            border-color: #ffdd57;
        }

        .test-icon {
            font-size: 1.5em;
            flex-shrink: 0;
        }

        .test-content {
            flex: 1;
        }

        .test-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .test-reason {
            color: #b0b0b0;
            font-size: 0.9em;
            font-style: italic;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d1b2, #00c4a7);
            width: 0%;
            transition: width 0.3s ease;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }

            100% {
                opacity: 1;
            }
        }

        .console-note {
            background: rgba(255, 221, 87, 0.1);
            border: 1px solid #ffdd57;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .console-note strong {
            color: #ffdd57;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .controls {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .stats {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üß™ Uki's Dive Tools - Test Runner</h1>
        <p class="subtitle">Automated Test Suite for Application Functionality</p>

        <div class="controls">
            <button id="runTestsBtn" onclick="runTests()">‚ñ∂Ô∏è Uruchom Testy</button>
            <button class="secondary" onclick="openApp()">üîó Otw√≥rz Aplikacjƒô</button>
            <button class="secondary" onclick="location.reload()">üîÑ Od≈õwie≈º</button>
        </div>

        <div id="status">
            <div class="status-header status-running">‚è≥ Uruchamianie test√≥w...</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div id="statusText"></div>
        </div>

        <div id="results">
            <div class="summary">
                <h2>üìä Podsumowanie Test√≥w</h2>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" style="color: #00d1b2;" id="passedCount">0</div>
                        <div class="stat-label">Passed ‚úÖ</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" style="color: #ff3860;" id="failedCount">0</div>
                        <div class="stat-label">Failed ‚ùå</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" style="color: #ffdd57;" id="skippedCount">0</div>
                        <div class="stat-label">Skipped ‚è≠Ô∏è</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" style="color: #fff;" id="duration">0s</div>
                        <div class="stat-label">Duration ‚è±Ô∏è</div>
                    </div>
                </div>
            </div>

            <div id="resultsContainer"></div>

            <div class="console-note">
                <strong>üí° Tip:</strong> Otw√≥rz konsolƒô przeglƒÖdarki (F12) aby zobaczyƒá szczeg√≥≈Çowe logi test√≥w.
            </div>
        </div>
    </div>

    <!-- ≈Åadowanie Test Suite -->
    <script src="automated-test.js"></script>

    <script>
        let testSuite = null;

        function openApp() {
            window.open('../index.html', '_blank');
        }

        async function runTests() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            const progressBar = document.getElementById('progressBar');
            const statusText = document.getElementById('statusText');
            const runBtn = document.getElementById('runTestsBtn');

            // Poka≈º status, ukryj results
            statusDiv.classList.add('visible');
            resultsDiv.classList.remove('visible');
            runBtn.disabled = true;
            runBtn.textContent = '‚è≥ Testowanie...';

            // Reset progress
            progressBar.style.width = '0%';

            try {
                // Otw√≥rz aplikacjƒô w nowym oknie
                const appWindow = window.open('../index.html', 'ukiApp');

                if (!appWindow) {
                    throw new Error('Nie mo≈ºna otworzyƒá aplikacji. Sprawd≈∫ blokadƒô pop-up√≥w.');
                }

                statusText.textContent = '≈Åadowanie aplikacji...';
                progressBar.style.width = '20%';

                // Czekaj na za≈Çadowanie
                await new Promise(resolve => {
                    let attempts = 0;
                    const checkLoad = setInterval(() => {
                        attempts++;
                        if (attempts > 50) {
                            clearInterval(checkLoad);
                            resolve();
                        }
                        try {
                            if (appWindow.document && appWindow.document.readyState === 'complete') {
                                clearInterval(checkLoad);
                                resolve();
                            }
                        } catch (e) {
                            // Cross-origin - assume loaded
                            clearInterval(checkLoad);
                            resolve();
                        }
                    }, 100);
                });

                await new Promise(resolve => setTimeout(resolve, 2000));

                statusText.textContent = 'Uruchamianie test√≥w...';
                progressBar.style.width = '40%';

                // Uruchom testy w oknie aplikacji
                const suite = new appWindow.UkiTestSuite();

                progressBar.style.width = '60%';
                statusText.textContent = 'Wykonywanie test√≥w...';

                const success = await suite.runAll();

                progressBar.style.width = '100%';

                // Wy≈õwietl wyniki
                displayResults(suite.results, success);

                // Zamknij okno aplikacji po testach
                setTimeout(() => {
                    appWindow.close();
                }, 1000);

            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="status-header status-error">‚ùå B≈ÇƒÖd uruchamiania test√≥w</div>
                    <p>${error.message}</p>
                    <p style="margin-top: 10px; color: #b0b0b0;">
                        Upewnij siƒô, ≈ºe plik index.html znajduje siƒô w katalogu nadrzƒôdnym.
                    </p>
                `;
            } finally {
                runBtn.disabled = false;
                runBtn.textContent = '‚ñ∂Ô∏è Uruchom Testy';
            }
        }

        function displayResults(results, success) {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            const resultsContainer = document.getElementById('resultsContainer');

            // Ukryj status, poka≈º results
            statusDiv.classList.remove('visible');
            resultsDiv.classList.add('visible');

            // Aktualizuj statystyki
            const total = results.passed.length + results.failed.length + results.skipped.length;
            document.getElementById('passedCount').textContent = results.passed.length;
            document.getElementById('failedCount').textContent = results.failed.length;
            document.getElementById('skippedCount').textContent = results.skipped.length;

            // Wyczy≈õƒá poprzednie wyniki
            resultsContainer.innerHTML = '';

            // Wy≈õwietl passed
            if (results.passed.length > 0) {
                const passedHeader = document.createElement('h3');
                passedHeader.textContent = `‚úÖ Testy Zako≈Ñczone Sukcesem (${results.passed.length})`;
                passedHeader.style.color = '#00d1b2';
                passedHeader.style.marginTop = '20px';
                resultsContainer.appendChild(passedHeader);

                results.passed.forEach(test => {
                    const div = document.createElement('div');
                    div.className = 'test-result pass';
                    div.innerHTML = `
                        <div class="test-icon">‚úÖ</div>
                        <div class="test-content">
                            <div class="test-name">${test}</div>
                        </div>
                    `;
                    resultsContainer.appendChild(div);
                });
            }

            // Wy≈õwietl failed
            if (results.failed.length > 0) {
                const failedHeader = document.createElement('h3');
                failedHeader.textContent = `‚ùå Testy Nieudane (${results.failed.length})`;
                failedHeader.style.color = '#ff3860';
                failedHeader.style.marginTop = '20px';
                resultsContainer.appendChild(failedHeader);

                results.failed.forEach(f => {
                    const div = document.createElement('div');
                    div.className = 'test-result fail';
                    div.innerHTML = `
                        <div class="test-icon">‚ùå</div>
                        <div class="test-content">
                            <div class="test-name">${f.test}</div>
                            <div class="test-reason">${f.reason}</div>
                        </div>
                    `;
                    resultsContainer.appendChild(div);
                });
            }

            // Wy≈õwietl skipped
            if (results.skipped.length > 0) {
                const skippedHeader = document.createElement('h3');
                skippedHeader.textContent = `‚è≠Ô∏è Testy Pominiƒôte (${results.skipped.length})`;
                skippedHeader.style.color = '#ffdd57';
                skippedHeader.style.marginTop = '20px';
                resultsContainer.appendChild(skippedHeader);

                results.skipped.forEach(s => {
                    const div = document.createElement('div');
                    div.className = 'test-result skip';
                    div.innerHTML = `
                        <div class="test-icon">‚è≠Ô∏è</div>
                        <div class="test-content">
                            <div class="test-name">${s.test}</div>
                            <div class="test-reason">${s.reason}</div>
                        </div>
                    `;
                    resultsContainer.appendChild(div);
                });
            }
        }
    </script>
</body>

</html>